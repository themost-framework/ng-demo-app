<div class="row" *ngIf="customer$ | async as customer">
    <div class="col-md-4 order-md-2 mb-4" *ngIf="orders$ | async as orders">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Customer orders</span>
        <span class="badge badge-secondary badge-pill">{{orders.total}}</span>
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed" *ngFor="let order of orders.value">
          <div>
            <h6 class="my-0">{{order.orderedItem.name}}</h6>
            <small class="text-muted">{{order.orderStatus.name}}</small>
            <br/>
            <small class="text-muted">{{order.orderDate | date : 'mediumDate'}}</small>
          </div>
          <span class="text-muted">{{order.orderedItem.price | currency}}</span>
        </li>
      </ul>
    </div>
    <div class="col-md-8 order-md-1">
      <h4 class="mb-3">{{customer.givenName}} {{customer.familyName}}</h4>
      <form class="needs-validation" novalidate="" #f="ngForm" (submit)="save(customer)">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="is-required" for="firstName">First name</label>
            <input type="text" class="form-control" id="firstName" name="firstName" [(ngModel)]="customer.givenName" placeholder="" [required]="true">
            <div class="invalid-feedback">
              Valid first name is required.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label class="is-required" for="familyName">Last name</label>
            <input type="text" class="form-control" id="familyName" name="familyName" [(ngModel)]="customer.familyName" placeholder="" [required]="true">
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

        <div class="mb-3">
            <label for="jobTitle">Job title</label>
            <input type="text" class="form-control" id="jobTitle" name="jobTitle" [(ngModel)]="customer.jobTitle" placeholder="" [required]="true">
            <div class="invalid-feedback">
              Please enter job title.
            </div>
          </div>

        <div class="mb-3" *ngIf="customer.user">
          <label class="is-required" for="username">Username</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">@</span>
            </div>
            <input type="text" class="form-control" id="username" name="username" [(ngModel)]="customer.user.name" placeholder="Username" required="">
            <div class="invalid-feedback" style="width: 100%;">
              Your username is required.
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="is-required" for="email">Email</label>
          <input type="email" class="form-control" id="email" name="email" [(ngModel)]="customer.email" placeholder="customer@example.com" [required]="true">
          <div class="invalid-feedback">
            Please enter a valid email address for shipping updates.
          </div>
        </div>

        <div class="mb-3">
            <label for="telephone">Phone number</label>
            <input type="text" class="form-control" id="telephone" name="telephone" [(ngModel)]="customer.address.telephone" placeholder="">
            <div class="invalid-feedback">
              Please enter a valid phone number.
            </div>
          </div>

        <div class="mb-3">
          <label class="is-required" for="address">Address</label>
          <input type="text" class="form-control" id="address" name="address" [(ngModel)]="customer.address.streetAddress" placeholder="1234 Main St" [required]="true">
          <div class="invalid-feedback">
            Please enter shipping address.
          </div>
        </div>
       
        <div class="mb-3">
            <label class="is-required" for="addressLocality">City</label>
            <input class="is-required" type="text" class="form-control" id="addressLocality" name="addressLocality" [(ngModel)]="customer.address.addressLocality" placeholder="1234 Main St" [required]="true">
            <div class="invalid-feedback">
              Please enter shipping address city.
            </div>
          </div>

        <div class="row">
          <div class="col-md-5 mb-3">
            <label class="is-required" for="addressCountry">Country</label>
            <select class="custom-select d-block w-100" id="addressCountry" name="addressCountry" [(ngModel)]="customer.address.addressCountry" [required]="true">
              <option value="">Choose...</option>
              <option *ngFor="let country of countries$ | async" [value]="country.cca2" >
                    {{country.name}}
                </option>
            </select>
            <div class="invalid-feedback">
              Please select a valid country.
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <label class="is-required" for="postalCode">Postal code</label>
            <input type="text" class="form-control" id="postalCode" name="postalCode" [(ngModel)]="customer.address.postalCode" placeholder="" [required]="true">
            <div class="invalid-feedback">
                Postal code required.
            </div>
          </div>
        </div>
        <div class="mt-2 mb-4">
            <button [disabled]="f.invalid" class="btn btn-primary btn-lg" type="submit">Save</button>
            <a class="ml-2 btn btn-secondary btn-lg" [routerLink]="['/customers']" >Back to customers</a>
        </div>
      </form>
    </div>
  </div>